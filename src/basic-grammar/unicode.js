// *** æ–‡å­—åˆ—ã¨Unicode ***

// JavaScriptã¯æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦Unicodeã‚’æ¡ç”¨ã—ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–¹å¼ã¨ã—ã¦UTF-16ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
// ã“ã®UTF-16ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã®ã¯ã€ã‚ãã¾ã§JavaScriptã®å†…éƒ¨ã§æ–‡å­—åˆ—ã‚’æ‰±ã†éš›ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼ˆå†…éƒ¨ã‚³ãƒ¼ãƒ‰ï¼‰ã§ã™ã€‚ ãã®ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼ˆå¤–éƒ¨ã‚³ãƒ¼ãƒ‰ï¼‰ã¯ã€UTF-8ã®ã‚ˆã†ã«UTF-16ä»¥å¤–ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã§ã‚ã£ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
//  ã—ã‹ã—ã€JavaScriptã®Stringã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã“ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼ˆUnicodeï¼‰ã«ç‰¹åŒ–ã—ãŸAPIã‚‚ã‚ã‚Šã¾ã™ã€‚ ã¾ãŸã€çµµæ–‡å­—ã‚’å«ã‚€ç‰¹å®šã®æ–‡å­—ã‚’æ‰±ã†éš›ã‚„ã€Œæ–‡å­—æ•°ã€ã‚’æ•°ãˆã‚‹ã¨ã„ã†å ´åˆã«ã¯ã€å†…éƒ¨ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚‹UTF-16ã‚’æ„è­˜ã—ãªã„ã¨ã„ã‘ãªã„å ´é¢ãŒã‚ã‚Šã¾ã™ã€‚

// * Code Point *
// Code Pointã¨Code Unitã®é•ã„
/**
 * Code Point(ç¬¦å·ä½ç½®)ã¯ã€ãã®æ–‡å­—ã®IDã€æ–‡ç« ã«ã™ã‚‹ã¨..ã€Œã“ã®æ–‡å­—ã®IDã¯XXXã§ã™ã€
 * Code Unit(ç¬¦å·å˜ä½)ã¯ã€æ–‡å­—åˆ—ã®æ§‹æˆè¦ç´ ã®æœ€å°å˜ä½
 * æ–‡ç« ã«ã™ã‚‹ã¨..ã€ŒJavaScriptã®å†…éƒ¨çš„ã«ã€ã“ã®æ–‡å­—åˆ—ã¯Code Unit2ã¤ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã€
 * JavaScriptãŒå†…éƒ¨çš„ã«æ¡ç”¨ã—ã¦ã„ã‚‹UTF-16ã§ã¯1Code Unitã§ã¯65536ç¨®é¡ã—ã‹è¡¨ç¾ã§ããªã„ã€‚
 * 65537ç¨®é¡ç›®ä»¥é™ã‚’è¡¨ç¾ã™ã‚‹å ´åˆã€ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã¨ã„ã†ä»•çµ„ã¿ã‚’ç”¨ã„ã¦æ–‡å­—åˆ—ã‚’è¡¨ç¾ã™ã‚‹ã€‚
 */

// æ–‡å­—åˆ—"ã‚"ã®Code Pointã‚’å–å¾—
console.log("ã‚".codePointAt(0)); // => 12354
// Code PointãŒ`12354`ã®æ–‡å­—ã‚’å–å¾—ã™ã‚‹
console.log(String.fromCodePoint(12354)); // => ã‚

// æ–‡å­—åˆ—ã‚’Code Unit(16é€²æ•°)ã®é…åˆ—ã«ã—ã¦è¿”ã™
function convertCodeunits(str) {
  const codeUnits = [];
  for (let i = 0; i < str.length; i++) {
    codeUnits.push(str.charCodeAt(i).toString(16));
  }
  return codeUnits;
}

// æ–‡å­—åˆ—ã‚’Code Point(16é€²æ•°)ã®é…åˆ—ã«ã—ã¦è¿”ã™
function convertCodePoints(str) {
  return Array.from(str).map((char) => {
    return char.codePointAt(0).toString(16);
  });
}

const str = "ã‚¢ã‚ªã‚¤";
const codeUnits = convertCodeUnits(str);
console.log(codeUnits); // => ["30a2", "30aa", "30a4"]
const codePoints = convertCodePoints(str);
console.log(codePoints); // => ["30a2", "30aa", "30a4"]

const str2 = "ãƒªãƒ³ã‚´ğŸ";
const codeUnits2 = convertCodeUnits(str);
console.log(codeUnits2); // => ["30ea", "30f3", "30b4", "d83c", "df4e"]
const codePoints2 = convertCodePoints(str);
console.log(codePoints2); // => ["30ea", "30f3", "30b4", "1f34e"]
// UTF-16ã§ã¯2ã¤Code Unitã®çµ„ã¿åˆã‚ã›ï¼ˆåˆè¨ˆ4ãƒã‚¤ãƒˆï¼‰ã§1ã¤ã®æ–‡å­—ï¼ˆ1ã¤ã®Code Pointï¼‰ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚

// * ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ *
/*
 * ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã§ã¯ã€2ã¤ã®Code Unitã®çµ„ã¿åˆã‚ã›ï¼ˆåˆè¨ˆ4ãƒã‚¤ãƒˆï¼‰ã§1ã¤ã®æ–‡å­—ï¼ˆ1ã¤ã®Code Pointï¼‰ã‚’è¡¨ç¾ã—ã¾ã™ã€‚UTF-16ã§ã¯ã€æ¬¡ã®ç¯„å›²ã‚’ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã«åˆ©ç”¨ã™ã‚‹é ˜åŸŸã¨ã—ã¦ã„ã¾ã™ã€‚
 * \uD800ï½\uDBFFï¼šä¸Šä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆã®ç¯„å›²
 * \uDC00ï½\uDFFFï¼šä¸‹ä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆã®ç¯„å›²
 * æ–‡å­—åˆ—ä¸­ã«ä¸Šä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆã¨ä¸‹ä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆã®Code UnitãŒä¸¦ã‚“ã å ´åˆã«ã€2ã¤ã®Code Unitã‚’çµ„ã¿åˆã‚ã›ã¦1æ–‡å­—ï¼ˆCode Pointï¼‰ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚
 */

// ä¸Šä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆ + ä¸‹ä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆã®çµ„ã¿åˆã‚ã›
console.log("\uD867\uDE3D"); // => "ğ©¸½"
// Code Pointã§ã®è¡¨ç¾
console.log("\u{29e3d}"); // => "ğ©¸½"

// ã“ã®ã‚ˆã†ã«ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã§ã¯ã€2ã¤ã®Code Unitã§1ã¤ã®Code Pointã‚’è¡¨ç¾ã—ã¾ã™ã€‚
// åŸºæœ¬çš„ã«ã¯ã€æ–‡å­—åˆ—ã¯Code UnitãŒé †ç•ªã«ä¸¦ã‚“ã§ã„ã‚‹ã‚‚ã®ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ãŸã‚ã€å¤šãã®Stringã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯Code Unitã”ã¨ã«ä½œç”¨ã—ã¾ã™ã€‚ ã¾ãŸã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚‚Code Unitã”ã¨ã¨ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã§è¡¨ç¾ã—ã¦ã„ã‚‹æ–‡å­—åˆ—ã§ã¯ã€ä¸Šä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆï¼ˆ0ç•ªç›®ï¼‰ã¨ä¸‹ä½ã‚µãƒ­ã‚²ãƒ¼ãƒˆï¼ˆ1ç•ªç›®ï¼‰ã¸ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã«ãªã‚Šã¾ã™ã€‚
// å†…éƒ¨çš„ã«ã¯Code UnitãŒä¸¦ã‚“ã§ã„ã‚‹ã‚‚ã®ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã„ã‚‹
console.log("\uD867\uDE3D"); // => "ğ©¸½"
// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚‚Code Unitã”ã¨ã¨ãªã‚‹
console.log("ğ©¸½"[0]); // => "\uD867"
console.log("ğ©¸½"[1]); // => "\uDE3D"

// çµµæ–‡å­—ã‚„ã€Œğ©¸½ï¼ˆã»ã£ã‘ï¼‰ã€ãªã©ã®ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã§è¡¨ç¾ã•ã‚Œã‚‹æ–‡å­—ãŒæ–‡å­—åˆ—ä¸­ã«å«ã¾ã‚Œã‚‹ã¨ã€Code Unitã”ã¨ã«æ‰±ã†æ–‡å­—åˆ—å‡¦ç†ã¯è¤‡é›‘ã«ãªã‚Šã¾ã™ã€‚
// ãŸã¨ãˆã°ã€Stringã®lengthãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯æ–‡å­—åˆ—ã«ãŠã‘ã‚‹Code Unitã®è¦ç´ æ•°ã‚’æ•°ãˆã‚‹ãŸã‚ã€"ğŸ".lengthã®çµæœã¯2ã¨ãªã‚Šã¾ã™ã€‚
console.log("ğŸ".length); // => 2

// ã“ã®ã‚ˆã†ãªå ´åˆã«ã¯ã€æ–‡å­—åˆ—ã‚’Code Pointã”ã¨ã«å‡¦ç†ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

// * Code Pointã‚’æ‰±ã† *
// ES2015ã§ã¯ã€æ­£è¦è¡¨ç¾ã«uï¼ˆUnicodeï¼‰ãƒ•ãƒ©ã‚°ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ ã“ã®uãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ãŸæ­£è¦è¡¨ç¾ã¯ã€æ–‡å­—åˆ—ã‚’Code PointãŒé †ç•ªã«ä¸¦ã‚“ã ã‚‚ã®ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚

const [all, fish] = "ğ©¸½ã®ã²ã‚‰ã".match(/(.)ã®ã²ã‚‰ã/);
console.log(all); // => "\ude3dã®ã²ã‚‰ã"
console.log(fish); // => "\ude3d"

// ã¤ã¾ã‚Šã€uãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ã¦ã„ãªã„æ­£è¦è¡¨ç¾ã¯ã€æ–‡å­—åˆ—ã‚’Code UnitãŒé †ç•ªã«ä¸¦ã‚“ã ã‚‚ã®ã¨ã—ã¦æ‰±ã£ã¦ã„ã¾ã™ã€‚

// ã“ã®ã‚ˆã†ãªæ„å›³ã—ãªã„çµæœã‚’é¿ã‘ã‚‹ã«ã¯ã€æ­£è¦è¡¨ç¾ã«uãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ã¾ã™ã€‚ uãƒ•ãƒ©ã‚°ãŒã¤ã„ãŸæ­£è¦è¡¨ç¾ã¯ã€æ–‡å­—åˆ—ã‚’Code Pointã”ã¨ã«æ‰±ã„ã¾ã™ã€‚ ãã®ãŸã‚ã€ä»»æ„ã®1æ–‡å­—ã«ãƒãƒƒãƒã™ã‚‹.ãŒğ©¸½ã¨ã„ã†æ–‡å­—ï¼ˆCode Pointï¼‰ã«ãƒãƒƒãƒã—ã¾ã™ã€‚
const [all2, fish2] = "ğ©¸½ã®ã²ã‚‰ã".match(/(.)ã®ã²ã‚‰ã/u);
console.log(all2); // => "ğ©¸½ã®ã²ã‚‰ã"
console.log(fish2); // => "ğ©¸½"

// Stringã®lengthãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€æ–‡å­—åˆ—ã‚’æ§‹æˆã™ã‚‹Code Unitã®å€‹æ•°ã‚’è¡¨ã™ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ã€‚ ãã®ãŸã‚ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã‚’å«ã‚€æ–‡å­—åˆ—ã§ã¯ã€lengthã®çµæœãŒè¦‹ãŸç›®ã‚ˆã‚Šå¤§ããªå€¤ã¨ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
// Code Unitã®å€‹æ•°ã‚’è¿”ã™
console.log("ğŸ".length); // => 2
console.log("\uD83C\uDF4E"); // => "ğŸ"
console.log("\uD83C\uDF4E".length); // => 2

// JavaScriptã«ã¯ã€æ–‡å­—åˆ—ã«ãŠã‘ã‚‹Code Pointã®å€‹æ•°ã‚’æ•°ãˆã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¯ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€æ–‡å­—åˆ—ã‚’Code Pointã”ã¨ã«åŒºåˆ‡ã£ãŸé…åˆ—ã¸å¤‰æ›ã—ã¦ã€é…åˆ—ã®é•·ã•ã‚’æ•°ãˆã‚‹ã®ãŒç°¡æ½”ã§ã™ã€‚
// Array.fromãƒ¡ã‚½ãƒƒãƒ‰[ES2015]ã¯ã€å¼•æ•°ã«iterableãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’å…ƒã«ã—ãŸæ–°ã—ã„é…åˆ—ã‚’è¿”ã—ã¾ã™ã€‚ iterableã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯Symbol.iteratorã¨ã„ã†ç‰¹åˆ¥ãªåå‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç·ç§°ã§ã€for...ofæ–‡ãªã©ã§åå¾©å‡¦ç†ãŒå¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ï¼ˆ
// Code Pointã”ã¨ã®é…åˆ—ã«ã™ã‚‹
// Array.fromãƒ¡ã‚½ãƒƒãƒ‰ã¯Iteratorã‚’é…åˆ—ã«ã™ã‚‹
const codePoints3 = Array.from("ãƒªãƒ³ã‚´ğŸ");
console.log(codePoints3); // => ["ãƒª", "ãƒ³", "ã‚´", "ğŸ"]
// Code Pointã®å€‹æ•°ã‚’æ•°ãˆã‚‹
console.log(codePoints3.length); // => 4

// ã—ã‹ã—ã€Code Pointã®æ•°ã‚’æ•°ãˆãŸå ´åˆã§ã‚‚ã€ç›´æ„Ÿçš„ãªçµæœã«ãªã‚‰ãªã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ ãªãœãªã‚‰ã€Code Pointã«ã¯åˆ¶å¾¡æ–‡å­—ãªã©ã®è¦–è¦šçš„ã«è¦‹ãˆãªã„ã‚‚ã®ã‚‚å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚ ãã®ãŸã‚ã€æ–‡å­—ã¨ã—ã¦æ•°ãˆãŸããªã„ã‚‚ã®ã¯ç„¡è¦–ã™ã‚‹ãªã©ã€è¦–è¦šçš„ãªæ–‡å­—åˆ—ã®é•·ã•ã‚’æ•°ãˆã‚‹ã«ã¯ã•ã‚‰ãªã‚‹å·¥å¤«ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

// æŒ‡å®šã—ãŸ`codePoint`ã®å€‹æ•°ã‚’æ•°ãˆã‚‹
// å…ˆã»ã©ç´¹ä»‹ã—ãŸArray.fromãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ãˆã°ã€æ–‡å­—åˆ—ã‚’Code Pointã§åŒºåˆ‡ã£ãŸæ–‡å­—ã®é…åˆ—ã¸ã¨å¤‰æ›ã§ãã¾ã™ã€‚ é…åˆ—ã«ã™ã‚Œã°ã€ã‚ã¨ã¯ã€Œãƒ«ãƒ¼ãƒ—ã¨åå¾©å‡¦ç†ã€ã®ç« ã§å­¦ã‚“ã æ–¹æ³•ã‚’ä½¿ã£ã¦ã€Code Pointã”ã¨ã«åå¾©å‡¦ç†ãŒã§ãã¾ã™ã€‚
function countOfCodePoints(str, codePoint) {
  return Array.from(str).filter((item) => {
    return item === codePoint;
  }).length;
}
console.log(countOfCodePoints("ğŸğŸ‡ğŸğŸ¥•ğŸ’", "ğŸ")); // => 2
